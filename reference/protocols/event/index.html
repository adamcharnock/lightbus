



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="RPC & event system for Python 3">
      
      
        <link rel="canonical" href="http://lightbus.org/reference/protocols/event/">
      
      
        <meta name="author" content="Adam Charnock">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../..">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Event Protocol (Redis) - Lightbus</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#e91e63">
      
    
    
      <script src="../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../static/stylesheets/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103655163-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#event-protocol-redis" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://lightbus.org" title="Lightbus" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Lightbus
            </span>
            <span class="md-header-nav__topic">
              
                Event Protocol (Redis)
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../tutorial/" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../howto/" class="md-tabs__link">
          How to
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../explanation/" class="md-tabs__link">
          Explanation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" class="md-tabs__link md-tabs__link--active">
          Reference
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://lightbus.org" title="Lightbus" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Lightbus
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/installation/" title="1. Installation" class="md-nav__link">
      1. Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/quick-start/" title="2. Quick start" class="md-nav__link">
      2. Quick start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/worked-example/" title="3. Worked example" class="md-nav__link">
      3. Worked example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/django-and-lightbus/" title="4. Django & Lightbus" class="md-nav__link">
      4. Django & Lightbus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/getting-involved/" title="Getting involved (even if you don't code)" class="md-nav__link">
      Getting involved (even if you don't code)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/access-your-bus-client/" title="Access your bus client" class="md-nav__link">
      Access your bus client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/schedule-recurring-tasks/" title="Schedule recurring tasks" class="md-nav__link">
      Schedule recurring tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/run-background-tasks/" title="Run background tasks" class="md-nav__link">
      Run background tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/migrate-from-celery-to-lightbus/" title="Migrate from Celery to Lightbus" class="md-nav__link">
      Migrate from Celery to Lightbus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/write-idempotent-event-handlers/" title="Write idempotent event handlers" class="md-nav__link">
      Write idempotent event handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/metrics/" title="Use Lightbus for realtime metrics" class="md-nav__link">
      Use Lightbus for realtime metrics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/event-sourcing/" title="Use Lightbus for event sourcing" class="md-nav__link">
      Use Lightbus for event sourcing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/modify-lightbus/" title="Modify Lightbus" class="md-nav__link">
      Modify Lightbus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Explanation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Explanation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/anatomy-lesson/" title="Anatomy lesson" class="md-nav__link">
      Anatomy lesson
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/bus/" title="The bus" class="md-nav__link">
      The bus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/rpcs/" title="Remote procedure calls" class="md-nav__link">
      Remote procedure calls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/marshalling/" title="Marshalling" class="md-nav__link">
      Marshalling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/transports/" title="Transports" class="md-nav__link">
      Transports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/lightbus-vs-celery/" title="Lightbus vs Celery" class="md-nav__link">
      Lightbus vs Celery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/architecture-tips/" title="Architecture tips" class="md-nav__link">
      Architecture tips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rpcs/" title="Remote procedure calls" class="md-nav__link">
      Remote procedure calls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../typing/" title="Typing" class="md-nav__link">
      Typing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-8" type="checkbox" id="nav-5-8">
    
    <label class="md-nav__link" for="nav-5-8">
      Command line use
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-8">
        Command line use
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/run/" title="run" class="md-nav__link">
      run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/inspect/" title="inspect" class="md-nav__link">
      inspect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/shell/" title="shell" class="md-nav__link">
      shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/dumpschema/" title="dumpschema" class="md-nav__link">
      dumpschema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/dumpconfigschema/" title="dumpconfigschema" class="md-nav__link">
      dumpconfigschema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing-and-mocking/" title="Testing & Mocking" class="md-nav__link">
      Testing & Mocking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plugins-development/" title="Plugin development" class="md-nav__link">
      Plugin development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transport-configuration/" title="Transport configuration" class="md-nav__link">
      Transport configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-13" type="checkbox" id="nav-5-13" checked>
    
    <label class="md-nav__link" for="nav-5-13">
      Protocols
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-13">
        Protocols
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rpc-and-result/" title="RPC & Result Protocol (Redis)" class="md-nav__link">
      RPC & Result Protocol (Redis)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Event Protocol (Redis)
      </label>
    
    <a href="./" title="Event Protocol (Redis)" class="md-nav__link md-nav__link--active">
      Event Protocol (Redis)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-events" class="md-nav__link">
    Sending events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stream_name" class="md-nav__link">
    {stream_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxlen" class="md-nav__link">
    MAXLEN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-events" class="md-nav__link">
    Consuming events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group_name" class="md-nav__link">
    {group_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumer_name" class="md-nav__link">
    {consumer_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream_name_1" class="md-nav__link">
    {stream_name}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reclaiming-timed-out-events" class="md-nav__link">
    Reclaiming timed-out events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#batch_size" class="md-nav__link">
    {batch_size}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    {timeout}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-customisation" class="md-nav__link">
    Encoding &amp; Customisation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-validation" class="md-nav__link">
    Data validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-deformation-casting" class="md-nav__link">
    Data deformation &amp; casting
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schema/" title="Schema Protocol (Redis)" class="md-nav__link">
      Schema Protocol (Redis)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-process/" title="Release process" class="md-nav__link">
      Release process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code-of-conduct/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-events" class="md-nav__link">
    Sending events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stream_name" class="md-nav__link">
    {stream_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxlen" class="md-nav__link">
    MAXLEN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-events" class="md-nav__link">
    Consuming events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group_name" class="md-nav__link">
    {group_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumer_name" class="md-nav__link">
    {consumer_name}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream_name_1" class="md-nav__link">
    {stream_name}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reclaiming-timed-out-events" class="md-nav__link">
    Reclaiming timed-out events
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#batch_size" class="md-nav__link">
    {batch_size}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    {timeout}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-customisation" class="md-nav__link">
    Encoding &amp; Customisation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-validation" class="md-nav__link">
    Data validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-deformation-casting" class="md-nav__link">
    Data deformation &amp; casting
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/adamcharnock/lightbus/edit/master/docs/reference/protocols/event.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="event-protocol-redis">Event protocol (Redis)<a class="headerlink" href="#event-protocol-redis" title="Permanent link">&para;</a></h1>
<p>Here we document the specific interactions between Lightbus and Redis. 
The concrete implementation of this is provided by the <code>RedisEventTransport</code> class. 
Before reading you should be familiar with Lightbus' <a href="../../../explanation/marshalling/">data marshalling</a>.</p>
<p>This documentation may be useful when debugging, developing third-party client libraries, 
or simply for general interest and review. <strong>You do not need to be aware of this 
protocol in order to use Lightbus</strong>.</p>
<h2 id="sending-events">Sending events<a class="headerlink" href="#sending-events" title="Permanent link">&para;</a></h2>
<p>The following command will send an event:</p>
<div class="codehilite"><pre><span></span>XADD {stream_name} [MAXLEN ~ {max_stream_length}] * {field_name_1} {field_value_1} {field_name_2} {field_value_2}...
</pre></div>

<h3 id="stream_name"><code>{stream_name}</code><a class="headerlink" href="#stream_name" title="Permanent link">&para;</a></h3>
<p>The <code>{stream_name}</code> value is composed in one of the following ways:</p>
<ul>
<li>One stream per event: <code>{api_name}.{event_name}</code></li>
<li>One stream per API: <code>{api_name}.*</code></li>
</ul>
<h3 id="maxlen"><code>MAXLEN</code><a class="headerlink" href="#maxlen" title="Permanent link">&para;</a></h3>
<p>The <code>MAXLEN ~ {max_stream_length}</code> component is optional, but will be used by Lightbus to 
limit the stream to the approximate configured length. </p>
<h3 id="fields">Fields<a class="headerlink" href="#fields" title="Permanent link">&para;</a></h3>
<p>Field names are strings. Field values are JSON-encoded strings.</p>
<p>The following metadata fields must be sent:</p>
<ul>
<li><code>:id</code> - A unique message ID</li>
<li><code>:api_name</code> - The API name for this event</li>
<li><code>:event_name</code> - The name of this event</li>
<li><code>:version</code> – The version of this event (<code>1</code> is a sensible default value)</li>
</ul>
<p>Note that metadata fields are prefixed by a colon. 
User-specified fields should not include this colon.</p>
<p>Lightbus does not currently provide specific functionality around the <code>version</code> 
field, but the field is available to developers via the <code>EventMessage</code> class. 
Lightbus may implement event functionality around event versions in future 
(such as event migrations).</p>
<h2 id="consuming-events">Consuming events<a class="headerlink" href="#consuming-events" title="Permanent link">&para;</a></h2>
<p>Consuming events involves an initial setup stage in which we check for any 
events which this process has consumed yet failed to process (for example, 
due to an error, hardware failure, network problem, etc).</p>
<p>We perform this initial check for events as follows:</p>
<div class="codehilite"><pre><span></span>XREAD_GROUP {group_name} {consumer_name} {stream_name} 0
</pre></div>

<p>The <code>0</code> above indicates we wish to receive un-acknowledged events for this consumer 
(i.e this Lightbus process).</p>
<p>Once we have received and processed any of these events, we can retrieve further events as follows:</p>
<div class="codehilite"><pre><span></span>XREAD_GROUP {group_name} {consumer_name} {stream} &gt;
</pre></div>

<h3 id="group_name"><code>{group_name}</code><a class="headerlink" href="#group_name" title="Permanent link">&para;</a></h3>
<p>The <code>{group_name}</code> value is comprised of the <a href="../../../explanation/events/#service-names-listener-names">service name and listener name</a> as follows: 
<code>{service_name}-{listener_name}</code>.</p>
<h3 id="consumer_name"><code>{consumer_name}</code><a class="headerlink" href="#consumer_name" title="Permanent link">&para;</a></h3>
<p>The <code>{consumer_name}</code> is set to the <a href="../../../explanation/events/#process-names">process name</a> of the Lightbus process.</p>
<h3 id="stream_name_1"><code>{stream_name}</code><a class="headerlink" href="#stream_name_1" title="Permanent link">&para;</a></h3>
<p>The stream name, as described above in <a href="#sending-events">sending events</a>.</p>
<h2 id="reclaiming-timed-out-events">Reclaiming timed-out events<a class="headerlink" href="#reclaiming-timed-out-events" title="Permanent link">&para;</a></h2>
<p>Events can be considered timed if another Lightbus process has held onto them for too long.
Any client consuming events should check for these from time to time.</p>
<p>Timed out events can be claimed as follows:</p>
<div class="codehilite"><pre><span></span># Get pending messages
XPENDING {stream} {group_name} - + {batch_size}

# For each message try to claim it
XCLAIM {stream} {group_name} {timeout}

# If successful, process the event. Otherwise ignore it
</pre></div>

<h3 id="batch_size"><code>{batch_size}</code><a class="headerlink" href="#batch_size" title="Permanent link">&para;</a></h3>
<p>How many pending messages to fetch in each batch</p>
<h3 id="timeout"><code>{timeout}</code><a class="headerlink" href="#timeout" title="Permanent link">&para;</a></h3>
<p>Timeout in milliseconds. This is the maximum time a Lightbus process will have to process an event 
before another processes assumes it has failed and takes over.</p>
<h3 id="encoding-customisation">Encoding &amp; Customisation<a class="headerlink" href="#encoding-customisation" title="Permanent link">&para;</a></h3>
<p>See also: <a href="../../../explanation/marshalling/">data marshalling</a></p>
<p>By default field values are serialised using JSON. This can be </p>
<p>This encoding is customisable within the Lightbus configuration. You are welcome to use 
something custom here, but be aware that:</p>
<ul>
<li>A single API must have a single encoding for all events on that API</li>
<li>All clients accessing the bus must be configured to use the same custom encoding</li>
</ul>
<h2 id="data-validation">Data validation<a class="headerlink" href="#data-validation" title="Permanent link">&para;</a></h2>
<p>Validation of outgoing and incoming events is optional. However, 
validation of outgoing events is recommended as sending of event messages which fail validation may 
result in the message being rejected by any consumer.</p>
<p>This validation can be 
performed using the using the schema available through the <a href="../schema/">schema protocol</a>.</p>
<h2 id="data-deformation-casting">Data deformation &amp; casting<a class="headerlink" href="#data-deformation-casting" title="Permanent link">&para;</a></h2>
<p>The Lightbus client provides Python-specific functionality to streamline the 
process of moving between Python data structures and interoperable JSON data 
structures.</p>
<p>The level of functionality required in this regard is not specified here, and 
is left up to individual library developers.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../rpc-and-result/" title="RPC & Result Protocol (Redis)" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                RPC & Result Protocol (Redis)
              </span>
            </div>
          </a>
        
        
          <a href="../schema/" title="Schema Protocol (Redis)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Schema Protocol (Redis)
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>