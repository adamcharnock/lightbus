



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="RPC & event system for Python 3">
      
      
        <link rel="canonical" href="http://lightbus.org/reference/protocols/rpc-and-result/">
      
      
        <meta name="author" content="Adam Charnock">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../..">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.0">
    
    
      
        <title>RPC & Result Protocol (Redis) - Lightbus</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#e91e63">
      
    
    
      <script src="../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../static/stylesheets/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103655163-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#rpc-result-protocol-redis" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://lightbus.org" title="Lightbus" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Lightbus
            </span>
            <span class="md-header-nav__topic">
              
                RPC & Result Protocol (Redis)
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../tutorial/" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../howto/" class="md-tabs__link">
          How to
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../explanation/" class="md-tabs__link">
          Explanation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" class="md-tabs__link md-tabs__link--active">
          Reference
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://lightbus.org" title="Lightbus" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Lightbus
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/adamcharnock/lightbus/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/installation/" title="1. Installation" class="md-nav__link">
      1. Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/quick-start/" title="2. Quick start" class="md-nav__link">
      2. Quick start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/worked-example/" title="3. Worked example" class="md-nav__link">
      3. Worked example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/django-and-lightbus/" title="4. Django & Lightbus" class="md-nav__link">
      4. Django & Lightbus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorial/getting-involved/" title="Getting involved (even if you don't code)" class="md-nav__link">
      Getting involved (even if you don't code)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How to
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How to
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/access-your-bus-client/" title="Access your bus client" class="md-nav__link">
      Access your bus client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/schedule-recurring-tasks/" title="Schedule recurring tasks" class="md-nav__link">
      Schedule recurring tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/run-background-tasks/" title="Run background tasks" class="md-nav__link">
      Run background tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/migrate-from-celery-to-lightbus/" title="Migrate from Celery to Lightbus" class="md-nav__link">
      Migrate from Celery to Lightbus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/write-idempotent-event-handlers/" title="Write idempotent event handlers" class="md-nav__link">
      Write idempotent event handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/metrics/" title="Use Lightbus for realtime metrics" class="md-nav__link">
      Use Lightbus for realtime metrics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/event-sourcing/" title="Use Lightbus for event sourcing" class="md-nav__link">
      Use Lightbus for event sourcing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../howto/modify-lightbus/" title="Modify Lightbus" class="md-nav__link">
      Modify Lightbus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Explanation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Explanation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/anatomy-lesson/" title="Anatomy lesson" class="md-nav__link">
      Anatomy lesson
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/services/" title="Services" class="md-nav__link">
      Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/bus/" title="The bus" class="md-nav__link">
      The bus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/rpcs/" title="Remote procedure calls" class="md-nav__link">
      Remote procedure calls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/marshalling/" title="Marshelling" class="md-nav__link">
      Marshelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/transports/" title="Transports" class="md-nav__link">
      Transports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/lightbus-vs-celery/" title="Lightbus vs Celery" class="md-nav__link">
      Lightbus vs Celery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/architecture-tips/" title="Architecture tips" class="md-nav__link">
      Architecture tips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../explanation/performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apis/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../rpcs/" title="Remote procedure calls" class="md-nav__link">
      Remote procedure calls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../typing/" title="Typing" class="md-nav__link">
      Typing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-8" type="checkbox" id="nav-5-8">
    
    <label class="md-nav__link" for="nav-5-8">
      Command line use
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-8">
        Command line use
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/run/" title="run" class="md-nav__link">
      run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/inspect/" title="inspect" class="md-nav__link">
      inspect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/shell/" title="shell" class="md-nav__link">
      shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/dumpschema/" title="dumpschema" class="md-nav__link">
      dumpschema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../command-line-use/dumpconfigschema/" title="dumpconfigschema" class="md-nav__link">
      dumpconfigschema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing-and-mocking/" title="Testing & Mocking" class="md-nav__link">
      Testing & Mocking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plugins-development/" title="Plugin development" class="md-nav__link">
      Plugin development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transport-configuration/" title="Transport configuration" class="md-nav__link">
      Transport configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-13" type="checkbox" id="nav-5-13" checked>
    
    <label class="md-nav__link" for="nav-5-13">
      Protocols
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-13">
        Protocols
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        RPC & Result Protocol (Redis)
      </label>
    
    <a href="./" title="RPC & Result Protocol (Redis)" class="md-nav__link md-nav__link--active">
      RPC & Result Protocol (Redis)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-rpc-calls-client" class="md-nav__link">
    Sending RPC Calls (client)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-return-path" class="md-nav__link">
    The return path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiving-rpc-results-client" class="md-nav__link">
    Receiving RPC Results (client)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-incoming-rpc-calls-server" class="md-nav__link">
    Consuming incoming RPC calls (server)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-serialisation-encoding" class="md-nav__link">
    Message serialisation &amp; encoding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serialisation" class="md-nav__link">
    Serialisation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rpc-message" class="md-nav__link">
    RPC Message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#result-message" class="md-nav__link">
    Result Message
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-customisation" class="md-nav__link">
    Encoding &amp; Customisation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-validation" class="md-nav__link">
    Data validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-deformation-casting" class="md-nav__link">
    Data deformation &amp; casting
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event/" title="Event Protocol (Redis)" class="md-nav__link">
      Event Protocol (Redis)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schema/" title="Schema Protocol (Redis)" class="md-nav__link">
      Schema Protocol (Redis)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-process/" title="Release process" class="md-nav__link">
      Release process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code-of-conduct/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-rpc-calls-client" class="md-nav__link">
    Sending RPC Calls (client)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-return-path" class="md-nav__link">
    The return path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiving-rpc-results-client" class="md-nav__link">
    Receiving RPC Results (client)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consuming-incoming-rpc-calls-server" class="md-nav__link">
    Consuming incoming RPC calls (server)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-serialisation-encoding" class="md-nav__link">
    Message serialisation &amp; encoding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serialisation" class="md-nav__link">
    Serialisation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rpc-message" class="md-nav__link">
    RPC Message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#result-message" class="md-nav__link">
    Result Message
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encoding-customisation" class="md-nav__link">
    Encoding &amp; Customisation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-validation" class="md-nav__link">
    Data validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-deformation-casting" class="md-nav__link">
    Data deformation &amp; casting
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/adamcharnock/lightbus/edit/master/docs/reference/protocols/rpc-and-result.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="rpc-result-protocol-redis">RPC &amp; result protocol (Redis)<a class="headerlink" href="#rpc-result-protocol-redis" title="Permanent link">&para;</a></h1>
<p>Here we document the specific interactions between Lightbus and Redis. 
The concrete implementation of this is provided by the <code>RedisRpcTransport</code> and 
<code>RedisResultTransport</code> classes. Before reading you should be familiar with Lightbus' <a href="../../../explanation/marshalling/">data marshalling</a>.</p>
<p>This documentation may be useful when debugging, developing third-party client libraries, 
or simply for general interest and review. <strong>You do not need to be aware of this 
protocol in order to use Lightbus</strong>.</p>
<h2 id="sending-rpc-calls-client">Sending RPC Calls (client)<a class="headerlink" href="#sending-rpc-calls-client" title="Permanent link">&para;</a></h2>
<p>The following Redis commands will send a remote procedure call:</p>
<div class="codehilite"><pre><span></span>RPUSH &quot;{api_name}:rpc_queue&quot; &quot;{blob_serialized_message}&quot;
SET &quot;rpc_expiry_key:{rpc_call_message_id}&quot;
EXPIRE &quot;rpc_expiry_key:{rpc_call_message_id}&quot; {rpc_timeout_seconds:5}
</pre></div>


<p>See <a href="#message-serialisation-encoding">message serialisation &amp; encoding</a> for the format of 
<code>{blob_serialized_message}</code>.</p>
<h3 id="the-return-path">The return path<a class="headerlink" href="#the-return-path" title="Permanent link">&para;</a></h3>
<p>Each RPC message must specify a <code>return_path</code> in its metadata. This states how the client 
expects to receive the result of the RPC. Both the client and the server must be able to 
comprehend and act up the provided return path, otherwise results will fail to be communicated.</p>
<p>Assuming you are using the built-in Redis RPC result transport, the return path 
should be in the following format:</p>
<div class="codehilite"><pre><span></span>redis+key://{api_name}.{rpc_name}:result:{rpc_call_message_id}
</pre></div>


<p>The server will place the RPC result into a Redis key. The value following 
<code>redis+key://</code> will be used as the key name.</p>
<h2 id="receiving-rpc-results-client">Receiving RPC Results (client)<a class="headerlink" href="#receiving-rpc-results-client" title="Permanent link">&para;</a></h2>
<p>The following Redis commands will block and await the result of an RPC call:</p>
<div class="codehilite"><pre><span></span>BLPOP &quot;{api_name}.{rpc_name}:result:{rpc_call_message_id}&quot;
</pre></div>


<p>This simply waits from a value to appear within the key specified by the <code>return_path</code>
in the sent RPC message.</p>
<p>See <a href="#message-serialisation-encoding">message serialisation &amp; encoding</a> for the format of 
the returned RPC result.</p>
<h2 id="consuming-incoming-rpc-calls-server">Consuming incoming RPC calls (server)<a class="headerlink" href="#consuming-incoming-rpc-calls-server" title="Permanent link">&para;</a></h2>
<p>RPCs are consumed as follows:</p>
<div class="codehilite"><pre><span></span># Blocks until a RPC message is received
BLPOP &quot;{api_name}:rpc_queue&quot;

DEL &quot;rpc_expiry_key:{rpc_call_message_id}&quot;
# If DEL returns 1 (key deleted) then execute the RPC
# If DEL returns 0 (key did not exist) then ignore the RPC

# Parse blob-serialised RPC message, Execute RPC, get result

LPUSH {redis_key_specific_in_return_path} {blob_serialized_result}
EXPIRE {redis_key_specific_in_return_path} {result_ttl_seconds}
</pre></div>


<h2 id="message-serialisation-encoding">Message serialisation &amp; encoding<a class="headerlink" href="#message-serialisation-encoding" title="Permanent link">&para;</a></h2>
<p>Above we have often referred to <code>{blob_serialized_message}</code> 
or <code>{blob_serialized_result}</code>. These are JSON blobs of data 
in a specific format.</p>
<h3 id="serialisation">Serialisation<a class="headerlink" href="#serialisation" title="Permanent link">&para;</a></h3>
<p>See also: <a href="../../../explanation/marshalling/">data marshalling</a></p>
<p>Within the Redis RPC transports all messages are serialised into a single 
value. This value is referred to as a 'blob'. This serialisation is 
performed by the <code>BlobMessageSerializer</code> and <code>BlobMessageDeserializer</code> classes.</p>
<h4 id="rpc-message">RPC Message<a class="headerlink" href="#rpc-message" title="Permanent link">&para;</a></h4>
<p>This is an outgoing RPC message body. This RPC message represents a request that an RPC be executed and a response be
returned.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Unique base64-encoded UUID</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;KrXz5EUXEem2gazeSAARIg==&quot;</span><span class="p">,</span>
        <span class="c1"># Fully qualified API name</span>
        <span class="s2">&quot;api_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my_company.auth&quot;</span><span class="p">,</span>
        <span class="c1"># The name of the remote procedure call</span>
        <span class="s2">&quot;procedure_name&quot;</span><span class="p">:</span> <span class="s2">&quot;check_password&quot;</span><span class="p">,</span>
        <span class="c1"># How and where should the result be sent</span>
        <span class="s2">&quot;return_path&quot;</span><span class="p">:</span> <span class="s2">&quot;redis+key://my_company.auth.check_password:result:KrXz5EUXEem2gazeSAARIg==&quot;</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># Key/value arguments potentiually needed to execute the remote procedure call</span>
    <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;adam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4 id="result-message">Result Message<a class="headerlink" href="#result-message" title="Permanent link">&para;</a></h4>
<p>This is the response message indicating an RPC has been 
(successfully or unsuccessfully) executed.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># The newly randomly generated ID of this RPC result message.</span>
        <span class="c1"># (base64-encoded UUID)</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;L4iXaEUgEemnBazeSAARIg==&quot;</span><span class="p">,</span>
        <span class="c1"># The ID of the received RPC call message</span>
        <span class="s2">&quot;rpc_message_id&quot;</span><span class="p">:</span> <span class="s2">&quot;KrXz5EUXEem2gazeSAARIg==&quot;</span><span class="p">,</span>
        <span class="c1"># String representation of any error which occurred</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Error stack trace. Only used in event of error, may be omitted otherwise</span>
        <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{error_stack_trace}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># The result as returned by the executed RPC</span>
    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>

<h3 id="encoding-customisation">Encoding &amp; Customisation<a class="headerlink" href="#encoding-customisation" title="Permanent link">&para;</a></h3>
<p>See also: <a href="../../../explanation/marshalling/">data marshalling</a></p>
<p>The message must be encoded as a string once it has been serialised to 
the above blob structure. The default implementation is to use JSON 
as this encoding.</p>
<p>This encoding is customisable within the Lightbus configuration. You are welcome to use 
something custom here, but be aware that:</p>
<ul>
<li>A single API must have a single encoding for all RPCs on that API</li>
<li>All clients accessing the bus must be configured to use the same custom encoding</li>
</ul>
<h2 id="data-validation">Data validation<a class="headerlink" href="#data-validation" title="Permanent link">&para;</a></h2>
<p>Validation of outgoing parameters and incoming results is optional. However, 
validation of outgoing parameters is recommended as sending of RPC messages which fail validation may 
result in the message being rejected by the Lightbus server.  </p>
<p>This validation can be 
performed using the using the schema available through the <a href="../schema/">schema protocol</a>.</p>
<h2 id="data-deformation-casting">Data deformation &amp; casting<a class="headerlink" href="#data-deformation-casting" title="Permanent link">&para;</a></h2>
<p>The Lightbus client provides Python-specific functionality to streamline the 
process of moving between Python data structures and interoperable JSON data 
structures.</p>
<p>The level of functionality required in this regard is not specified here, and 
is left up to individual library developers.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../event/" title="Event Protocol (Redis)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Event Protocol (Redis)
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.a8b5e56f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>